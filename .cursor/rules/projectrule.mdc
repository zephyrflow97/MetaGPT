---
alwaysApply: true
---
# MGX Clone 开发规则

> ⚠️ 本文件包含稳定的开发规则和约束，不应频繁修改。项目状态和开发计划请参考 `mgx_clone/README.md`。

## 项目概述

MGX Clone 是一个基于 MetaGPT 的自然语言编程平台，复刻 MGX.dev 的核心功能。所有 MGX Clone 相关代码位于 `mgx_clone/` 目录下。

## 环境配置（重要）

### 虚拟环境
- **包管理工具**: 使用 `uv` 管理 Python 虚拟环境（因为本项目从 MetaGPT 二次开发而来）
- **虚拟环境位置**: 项目根目录 `/Users/suifeng/Project/MetaGPT/.venv`，**不是** `mgx_clone/.venv`
- **激活虚拟环境**: 
  ```bash
  cd /Users/suifeng/Project/MetaGPT
  source .venv/bin/activate
  ```
- **安装依赖**: 
  ```bash
  uv pip install -r mgx_clone/backend/requirements.txt
  ```

### 关键路径
| 路径 | 说明 |
|------|------|
| `/Users/suifeng/Project/MetaGPT/.venv` | Python 虚拟环境 |
| `/Users/suifeng/Project/MetaGPT/config/config2.yaml` | MetaGPT LLM 配置 |
| `/Users/suifeng/Project/MetaGPT/workspace/` | 生成代码存储目录 |
| `/Users/suifeng/Project/MetaGPT/mgx_clone/` | MGX Clone 源代码 |
| `/Users/suifeng/Project/MetaGPT/mgx_clone/data/mgx_clone.db` | SQLite 数据库 |

## 核心约束

### 技术栈限制
- **后端**: FastAPI + WebSocket + SQLite(aiosqlite) + MetaGPT + Pydantic
- **前端**: Next.js 14 (App Router) + TypeScript + Tailwind CSS + Lucide React
- **禁止引入未在 README 中列出的核心依赖**，如需新增请先说明理由

## 代码规范

### 后端 (Python)
- 使用 Black 格式化代码
- 使用 Ruff 进行代码检查
- 遵循 PEP 8 规范
- 所有 API 函数必须是异步的（async/await）
- 使用 Pydantic 进行数据验证
- 日志使用标准 logging 模块
- 异常处理要完善，返回有意义的错误信息

### 前端 (TypeScript)
- 使用 ESLint + Prettier 格式化
- 使用函数式组件和 Hooks
- 使用 TypeScript 严格模式
- 组件文件使用 PascalCase 命名
- 类型定义放在 `lib/types.ts`
- 避免使用 any 类型

## 开发流程规范

### 提交规范 (Conventional Commits)
```
feat: 添加新功能
fix: 修复 bug
docs: 更新文档
style: 代码格式修改
refactor: 代码重构
test: 添加测试
chore: 构建/工具修改
```

### 分支策略
- `main`: 稳定版本
- `develop`: 开发分支
- `feature/*`: 功能分支
- `fix/*`: Bug 修复分支

## 文档更新规范

> 代码变更时，必须同步更新 `mgx_clone/README.md` 中对应的章节，保持文档与代码一致。

### 触发更新的场景

| 代码变更类型 | 需更新的 README 章节 |
|-------------|---------------------|
| 新增/删除/重命名文件或目录 | `项目结构` |
| 新增/修改/删除 REST API | `API 文档 > REST API 端点` |
| 新增/修改/删除 WebSocket 消息类型 | `API 文档 > WebSocket 端点` |
| 新增/修改/删除数据库表或字段 | `数据库规范` |
| 完成开发计划中的功能 | `版本历史`（添加）+ `开发计划`（打勾） |
| 修复重要 Bug | `版本历史 > Bug 修复` |
| 新增依赖包 | `技术栈` |

### 更新原则

1. **即时更新**: 代码变更的同一次提交中更新文档
2. **最小更新**: 只更新受影响的章节，不做无关修改
3. **保持格式**: 遵循现有的 Markdown 格式和表格样式
4. **版本记录**: 重要功能完成后，在 `版本历史` 中记录

### 版本历史更新规则

当完成一个功能或修复时：
1. 在 `开发计划` 中将对应项从 `[ ]` 改为 `[x]`
2. 在 `版本历史 > 当前版本` 对应分类下添加 `- ✅ 功能描述`

## 服务启动

### 后端
```bash
cd /Users/suifeng/Project/MetaGPT
source .venv/bin/activate
cd mgx_clone/backend
python -m uvicorn main:app --reload --port 8000
```

### 前端
```bash
cd /Users/suifeng/Project/MetaGPT/mgx_clone/frontend
pnpm dev
```

### 一键启动
```bash
cd /Users/suifeng/Project/MetaGPT/mgx_clone/scripts
./start.sh
```

## 重要注意事项

1. **虚拟环境**: 必须使用项目根目录的 `.venv`，不要在 `mgx_clone/` 下创建新的虚拟环境
2. **MetaGPT 配置**: 需要有效的 `config/config2.yaml` 配置 LLM API Key
3. **工作目录**: 生成的代码存储在项目根目录的 `workspace/` 下
4. **数据库文件**: 位于 `mgx_clone/data/mgx_clone.db`
5. **端口**: 后端 8000，前端 3000
6. **React Strict Mode**: 前端已兼容，注意避免双重渲染问题
7. **WebSocket**: 注意防止双重连接问题

